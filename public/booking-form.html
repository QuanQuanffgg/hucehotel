<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Đặt Phòng Chi Tiết - HUCE HOTEL</title>

  <!-- Font luxury -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    /* Sửa lại CSS cho Toast để hỗ trợ nhiều loại thông báo */
    .toast {
      position: fixed;
      bottom: -100px; /* Ẩn dưới cùng */
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(90deg, #d4af37, #f0c14b); /* Mặc định vàng gold */
      color: #0f172a;
      padding: 16px 40px;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      z-index: 10000;
      opacity: 0;
      white-space: nowrap;
    }

    .toast.show {
      opacity: 1;
      bottom: 40px; /* Nhảy lên */
    }

    /* Thêm màu cho thông báo lỗi */
    .toast.error {
      background: linear-gradient(90deg, #ff4b2b, #ff416c);
      color: #fff;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: #51a4f6;
      min-height: 100vh;
      padding: 40px 15px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      background: #ffffff;
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.1);
      border: 1px solid #eee;
    }

    header {
      background: linear-gradient(135deg, #0f172a, #1e293b);
      color: #d4af37;
      text-align: center;
      padding: 60px 30px;
      position: relative;
    }

    header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #d4af37, #f0c14b);
    }

    header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 48px;
      font-weight: 700;
      letter-spacing: 3px;
      margin-bottom: 10px;
    }

    header p {
      font-size: 20px;
      font-weight: 300;
      opacity: 0.9;
      letter-spacing: 1px;
    }

    .form-body {
      display: flex;
      flex-wrap: wrap;
    }

    .left, .right {
      flex: 1;
      min-width: 340px;
      padding: 60px 50px;
    }

    .left {
      background: #fdfdfd;
      border-right: 1px solid #eee;
    }

    .right {
      background: #fafafa;
    }

    h2 {
      font-family: 'Playfair Display', serif;
      color: #0f172a;
      margin-bottom: 40px;
      font-size: 32px;
      font-weight: 600;
      position: relative;
      padding-bottom: 15px;
    }

    h2::after {
      content: '';
      width: 80px;
      height: 3px;
      background: #d4af37;
      position: absolute;
      bottom: 0;
      left: 0;
    }

    label {
      display: block;
      margin: 25px 0 10px;
      font-weight: 500;
      color: #444;
      font-size: 16px;
      letter-spacing: 0.5px;
    }

    input, select {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 14px;
      font-size: 16px;
      background: #fff;
      transition: all 0.3s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #d4af37;
      box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.15);
    }

    button {
      margin-top: 50px;
      width: 100%;
      padding: 20px;
      background: linear-gradient(90deg, #d4af37, #f0c14b);
      color: #0f172a;
      border: none;
      border-radius: 16px;
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.4s ease;
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(212, 175, 55, 0.4);
      background: linear-gradient(90deg, #c4a137, #e0b14b);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #roomPreview {
      display: none;
      background: #ffffff;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
      border: 2px solid #f0e6d2;
    }

    #roomPreview h3 {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      color: #0f172a;
      margin-bottom: 20px;
    }

    #roomPreview img {
      width: 100%;
      max-height: 380px;
      object-fit: cover;
      border-radius: 16px;
      margin: 20px 0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    #roomPreview p {
      font-size: 17px;
      color: #555;
      line-height: 1.7;
      margin: 20px 0;
    }

    .price {
      font-family: 'Playfair Display', serif;
      font-size: 36px;
      color: #d4af37;
      font-weight: 700;
      margin-top: 25px;
    }

    .toast {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(90deg, #d4af37, #f0c14b);
      color: #0f172a;
      padding: 20px 50px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: 600;
      opacity: 0;
      transition: all 0.5s ease;
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
      bottom: 80px;
    }

    @media (max-width: 768px) {
      .left, .right {
        padding: 40px 30px;
      }
      .left {
        border-right: none;
        border-bottom: 1px solid #eee;
      }
      header h1 {
        font-size: 38px;
      }
    }
  </style>
</head>

<body>

<div id="toast" class="toast">Đặt phòng thành công!</div>

<div class="container">
  <header>
    <h1>HUCE HOTEL</h1>
    <p>Trải nghiệm dịch vụ nghỉ dưỡng thượng lưu</p>
  </header>

  <div class="form-body">
    <div class="left">
      <h2>Thông tin đặt phòng</h2>

      <label>Họ và tên</label>
      <input id="fullName" placeholder="Tự động điền nếu đã đăng nhập">

      <label>Email</label>
      <input id="email" type="email" placeholder="email@example.com">

      <label>Số điện thoại *</label>
      <input id="phone" placeholder="0901234567" required>

      <label>Ngày nhận phòng *</label>
      <input id="checkin" type="date" required>

      <label>Ngày trả phòng *</label>
      <input id="checkout" type="date" required>

      <label>Chọn loại phòng *</label>
      <select id="roomSelect" required></select>

      <button onclick="submitBooking()">XÁC NHẬN ĐẶT PHÒNG</button>
    </div>

    <div class="right">
      <h2>Xem trước phòng</h2>
      <div id="roomPreview">
        <h3 id="roomTitle"></h3>
        <img id="roomImage" src="" alt="Phòng khách sạn">
        <p id="roomDesc"></p>
        <div class="price" id="roomPrice"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ================= JWT CHECK ================= */
const token = localStorage.getItem("token");
const user = JSON.parse(localStorage.getItem("user") || "null");

if (!token) {
  showToast("Bạn cần đăng nhập để đặt phòng!",true);
  location.href = "/login.html";
}

/* ================= USER ================= */
if (user) {
  document.getElementById('fullName').value = user.name || "";
  document.getElementById('email').value = user.email || "";
}

/* ================= ROOMS ================= */
const rooms = [];
for (let i = 0; i < 10; i++) {
  rooms.push({ id: 101+i, type: "Phòng Đơn", price: 800000, image: "phong1.jpg", desc: "Đánh thức mọi giác quan trong không gian tinh tế với hệ thống cửa kính chạm trần ôm trọn nhịp sống đô thị. Căn phòng sở hữu nội thất hiện đại, giường đơn tiêu chuẩn hoàng gia và hệ thống chiếu sáng thông minh. Đây là lựa chọn hoàn hảo cho những chuyến công tác hay phút giây riêng tư đầy đủ tiện nghi." });
  rooms.push({ id: 201+i, type: "Phòng Đôi", price: 1200000, image: "phong2.jpg", desc: "Biểu tượng của sự lãng mạn với giường King-size êm ái và bộ chăn ga lụa cao cấp. Không gian hòa quyện giữa ánh sáng tự nhiên và nội thất gỗ sang trọng, đi kèm phòng tắm đá Marble trắng và vòi sen massage. Căn phòng hứa hẹn mang đến một kỳ nghỉ dưỡng khó quên, tràn đầy cảm hứng cho các cặp đôi" });
  rooms.push({ id: 301+i, type: "VIP Suite", price: 2800000, image: "phong3.jpg", desc: "Đỉnh cao thượng lưu với phòng khách tách biệt và ban công riêng biệt lập ngắm toàn cảnh hoàng hôn. Chủ nhân căn Suite sẽ tận hưởng đặc quyền phục vụ 24/7 từ quản gia riêng, quầy bar thượng hạng và dàn âm thanh đỉnh cao. Một không gian đế vương khẳng định vị thế và phong cách sống khác biệt." });
}

const roomSelect = document.getElementById('roomSelect');
rooms.forEach(r => {
  const opt = document.createElement("option");
  opt.value = r.id;
  opt.textContent = `Phòng ${r.id} - ${r.type} (${r.price.toLocaleString()}đ/đêm)`;
  roomSelect.appendChild(opt);
});

roomSelect.onchange = () => {
  const room = rooms.find(r => r.id == roomSelect.value);
  const preview = document.getElementById('roomPreview');
  preview.style.display = "block";
  document.getElementById('roomTitle').textContent = `Phòng ${room.id} - ${room.type}`;
  document.getElementById('roomImage').src = "images/" + room.image;
  document.getElementById('roomDesc').textContent = room.desc;
  document.getElementById('roomPrice').textContent = room.price.toLocaleString() + "đ / đêm";
};

/* ================= SUBMIT ================= */
async function submitBooking() {
  const phone = document.getElementById('phone');
  const checkin = document.getElementById('checkin');
  const checkout = document.getElementById('checkout');
  const roomSelect = document.getElementById('roomSelect');

  if (!phone.value || !checkin.value || !checkout.value || !roomSelect.value) {
    showToast("Vui lòng nhập đủ thông tin bắt buộc!",true);
    return;
  }

  const res = await fetch("/api/bookings", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({
      phone: phone.value,
      roomId: roomSelect.value,
      checkin: checkin.value,
      checkout: checkout.value
    })
  });

  const data = await res.json();
  if (data.success) {
    document.getElementById('toast').classList.add("show");
    setTimeout(() => location.href = "/myrooms.html", 2500);
  } else {
    showToast(data.message || "Đặt phòng thất bại", true);
  }
}
function showToast(message, isError = false) {
    // Tạo element toast mới
    const toast = document.createElement("div");
    toast.className = "toast";
    if (isError) toast.classList.add("error");
    toast.textContent = message;
    document.body.appendChild(toast);

    // Kích hoạt hiệu ứng hiện lên
    setTimeout(() => toast.classList.add("show"), 100);

    // Tự động biến mất sau 3 giây
    setTimeout(() => {
        toast.classList.remove("show");
        setTimeout(() => toast.remove(), 500); // Xóa khỏi DOM
    }, 3000);
}

/* Kiểm tra Token thay vì alert */
if (!token) {
  showToast("Bạn cần đăng nhập để đặt phòng!", true);
  setTimeout(() => location.href = "/login.html", 2000);
}

/* ... (Phần logic rooms giữ nguyên) ... */

/* Cập nhật hàm Submit */
async function submitBooking() {
  const phone = document.getElementById('phone');
  const checkin = document.getElementById('checkin');
  const checkout = document.getElementById('checkout');
  const roomSelect = document.getElementById('roomSelect');

  if (!phone.value || !checkin.value || !checkout.value || !roomSelect.value) {
    showToast("Vui lòng nhập đủ thông tin bắt buộc!", true);
    return;
  }

  try {
    const res = await fetch("/api/bookings", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        phone: phone.value,
        roomId: roomSelect.value,
        checkin: checkin.value,
        checkout: checkout.value
      })
    });

    const data = await res.json();
    if (data.success) {
      showToast("Đặt phòng thành công! Đang chuyển hướng...");
      setTimeout(() => location.href = "/myrooms.html", 2500);
    } else {
      showToast(data.message || "Đặt phòng thất bại", true);
    }
  } catch (err) {
    showToast("Lỗi kết nối máy chủ!", true);
  }
}
</script>

</body>
</html>